#!/usr/bin/env python
import sys
import os

#(gdb)source /gdb_python/i_r.py
sys.stdout = open("/gdb_python/i_r.txt","w")

def gdbexecute(cmd, tostring):
	try:
		return gdb.execute(cmd,to_string=tostring)
	except:
		print("gdb.execute failed command = {0}".format(cmd))

#shell cat /proc/xxxx/maps
proc = gdbexecute('i proc map', True)
print("----------------------------------------------------------------------------------------------------------")
print(proc)
print("----------------------------------------------------------------------------------------------------------")
cmd = "i r"
tmp = gdbexecute(cmd, True)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $eax"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $ecx"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $edx"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $ebx"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $esp"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $ebp"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $esi"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20wx $edi"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")
cmd = "x/20i $eip"
tmp = gdbexecute(cmd, True)
print(cmd)
print(tmp)
print("----------------------------------------------------------------------------------------------------------")

sys.stdout.close()
sys.stdout = sys.__stdout__
print("write i_r.txt")
